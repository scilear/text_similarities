S&P 500 companies spent $131.6 billion or 8.7% less on share repurchases in the second quarter compared to the first quarter 2015, but 13.2% more than in the second quarter 2014 as companies try to boost their EPS.

Total shareholder return, both dividends and dividends, was a 12-month record $923.3 billion in the second quarter. Further, it marked the second quarter in which more than 20% of index companies reduced their share count by at least 4%, increasing their EPS by 4% at minimum year over year. And more companies were buying back their shares - 307 compared to 299 in the first quarter and 295 in second quarter 2014.

"Companies continue to use buybacks to add to their EPS at a time when EPS growth has become the center of attention for investors," Howard Silverblatt, Senior Index Analyst at S&P Dow Jones Indices, said.

Earnings for S&P 500 companies are projected to decrease 4.4%, which would make it the first two consecutive quarters of earnings decreases since 2009, according to Factset.

The surge could end depending on the Fed's interest rate decision.

"While companies currently have the resources and low-cost access to funds to continue this trend, once interest rates increase, the higher costs will eventually influence the decision making process for corporate expenditures," he said. "Buybacks may be more susceptible to an interest rate hike, given that they are more discretionary and dividend cutbacks are typically seen as a last resort action. Based on the current data, the Q3 actual dividend payment is expected to be the sixth consecutive quarter of new record payments, with Q4 2015 expected to be the seventh."

Warren Buffett (Trades, Portfolio) has said that companies buying back their shares only makes sense under certain circumstances.

"Berkshire (BRK-A)(BRK-B)'s directors will only authorize repurchases at a price they believe to be well below intrinsic value," he said in his 2014 shareholder letter. "In our view, that is an essential criterion for repurchases that is often ignored by other management."

According to GuruFocus data, some of the companies with the greatest largess in the quarter appeared to buy their shares when they were undervalued, and some didn't.

The companies that spent the most on share buybacks were Apple (AAPL), Express Scripts (ESRX), Qualcomm (QCOM), AbbVie (ABBV) and Microsoft (MSFT).

Apple (AAPL)

Apple shares have gained 14% over the past year, closing at $115, off of its 52-week high of $134.54. The GuruFocus DCF calculator gives the stock a fair value of $246.54, for a 53% margin of safety. Apple also has a P/E of 13.29, and two other ratios at one-year lows: a P/B of 4.8 and P/S of 2.76.

The purchaser of the biggest new stake in the company in the second quarter was David Tepper (Trades, Portfolio), who bought 2,518,167 shares, which makes up 7.8% of his long portfolio. Carl Icahn (Trades, Portfolio) has the largest position - 52,769,848 shares filling 21.2% of his portfolio. Gurus who sold out were Ken Heebner (Trades, Portfolio) and Steve Mandel (Trades, Portfolio).

Express Scripts (ESRX)

Express Scripts shares rose 11% to $82 in the past year, close to a 10-year high. The company has a DCF fair value of $75.07, 10% above a margin of safety. It also has a P/E of 27, P/B of 3.5 and P/S of 0.59.

View gallery .

In the second quarter, Steven Cohen (Trades, Portfolio) made the only new purchase of the company with 54,200 shares, and Jeff Auxier (Trades, Portfolio) made the largest increase at 173.7% for 73,997 shares. The greatest position was held by Dodge & Cox, who had 27,932,629 shares after increasing 15.3% in the quarter. Vanguard Health Care Fund (Trades, Portfolio) sold 95% of his position and Joel Greenlatt sold 87%, the largest reductions.

Qualcomm (QCOM)

Qualcomm shares dropped 29% over the year to $53.28 at close, close to its 52-week low of $52.39. The DCF calculator gave the company a fair value price of $71.13 for a 25% margin of safety. The company has a P/E ratio of 14.6. Its PB ratio of 2.57 and P/S ratio of 3.42 are both near their respective 10-year lows.

View gallery .

Only one guru, Steven Cohen (Trades, Portfolio), sold out his position in Qualcomm. The largest new established position was made by Zeke Ashton (Trades, Portfolio) who bought 45,000 shares worth 4.85% of his portfolio. The largest position is held by Jana Partners (Trades, Portfolio) with 28,819,654 shares or 10.7% of the portfolio.

AbbVie (ABBV)

AbbVie shares have declined 4% over the last year, closing at $56.58, off their one-year high of $71.60. It has a P/E of 45.49, higher than 69% of the companies in the global drug manufacturer industry. Its P/S ratio of 4.42 is higher than 65% of the companies in the industry.

View gallery .

First Eagle Investment (Trades, Portfolio) and Louis Moore Bacon (Trades, Portfolio) each bought new stakes in the company, while Larry Robbins (Trades, Portfolio) has the largest position at 17,855,941 shares or 4.75% of his portfolio. He boosted the position 630.7%. Westport Asset Management (Trades, Portfolio) and Manning & Napier Advisors both sold out.

Microsoft (MSFT)

Microsoft shares fell 3% over the past year, closing at $43.91, off their one-year high of $50.04. The DCF calculator gives Microsoft a fair value of $17.19, or 158% overvalued. Microsoft has a P/E of 30.28, which is near a 10-year high. It also has a P/B of 4.44 and P/S of 3.87.

View gallery .

Three gurus started positions in Microsoft in the second quarter: Stanley Druckenmiller (Trades, Portfolio), Jim Simons (Trades, Portfolio) and Steven Cohen (Trades, Portfolio). Dodge & Cox owns the greatest stake, consisting of 81,802,094 shares, which it decreased by 1.86%. Three gurus sold out of the company: Louis Moore Bacon (Trades, Portfolio), Tom Gayner (Trades, Portfolio) and Signature Select Canadian Fund (Trades, Portfolio).

Find more companies buying back their shares with the All-in-One screener, a Premium feature. Not a Premium Member of GuruFocus?Try it free for 7 days here. Get your ticket to the GuruFocus 2016 Value Conference here!

This article first appeared on GuruFocus